<!--
	Copyright (C) 2012,2013 by Calango Rei Games, wich is:
	Felipe Tavares, Brenno Arruda, Vinicius Abdias, Mateus Medeiros and Giovanna Gorgônio
-->

<!DOCTYPE HTML>

<html>
	<head>
		<title>JSEngine</title>
		<meta charset="utf8" />
		<style type="text/css">
			@import url(style.css);
			@import url(css/UI.css);
		</style>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="html5.js"></script>
		<script type="text/javascript" src="main.js"></script>
		<script type="text/javascript" src="modules/list.js"></script>
		<script type="text/javascript" src="assets/list.js"></script>
	</head>

	<body>
		<canvas id="html_canvas" width=640px height=480px>
		</canvas>

		<div id="console">
			<div id="console_text">
			</div>
			<input id="console_entrance" type="text"></input>
		</div>

		<script type="text/javascript">
			var map1 = [
				['#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','X','X','X','X','X','X','X','X','_','_','_','_','#'],
				['#','_','_','X','_','_','_','_','_','_','X','_','_','_','_','#'],
				['#','_','_','X','_','_','_','_','_','_','X','_','_','_','_','#'],
				['#','_','_','X','_','_','_','@','_','_','X','_','_','_','_','#'],
				['#','_','_','X','_','_','_','_','_','_','X','_','_','_','_','#'],
				['#','_','_','X','X','X','X','X','X','X','X','_','_','_','_','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','_','_','T','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','_','_','_','_','_','_','_','_','_','_','_','_','_','_','#'],
				['#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'],
			];

			function createMenu () {
				GameMenu = new UIPanel();
				var menu = new UIListView("Menu");
				var hiscores = new UIListView("High Scores");
				//var load = new UIListView("Load Game");

				GameMenu.addView (menu);
				GameMenu.addView (hiscores);
				//GameMenu.addView (load);

				menu.constructor = function () {
					this.list = [
						{
							content: "Play!",
							onActivate: function () {
								var gameRenderer = new scnBomberman.renderer();
								gameRenderer.scene = new scnBomberman.scene();

								jsEngine.modules.render.renderer = gameRenderer;
							
								jsEngine.modules.map.reset();
								jsEngine.modules.map.addMap ("inicial", new TileMap(16,16,32, map1));
								jsEngine.modules.map.setCurrentMap ("inicial");
							
								jsEngine.modules.hud.reset();
								jsEngine.modules.hud.addText ("score", "0", 10,10);
								
								jsEngine.modules.combo.reset();

								this.panel.hide();
								jsEngine.modules.messages.addMessage(new Message("Fight!"));
							},
							onSelect: null
						},
						{
							content: "High Scores",
							onActivate: function () {this.panel.switchTo(1)},
							onSelect: null
						},
					];
				}

				
				hiscores.constructor = function () {
					this.list = [];

					this.list.push({
						content: ""+localStorage.ha?localStorage.ha:0,
						onActivate: null,
						onSelect: null
					});
					this.list.push({
						content: ""+localStorage.hb?localStorage.hb:0,
						onActivate: null,
						onSelect: null
					});
					this.list.push({
						content: ""+localStorage.hc?localStorage.hc:0,
						onActivate: null,
						onSelect: null
					});

					this.list.push({
						content: "↵",
						onActivate: function () {this.panel.switchTo(0)},
						onSelect: null
					});
				}

				/*
				save.constructor = function () {
					this.list = [
						{
							content: "↵",
							onActivate: function () {this.GameMenu.switchTo(0)},
							onSelect: null
						}
					];
				}
				*/

				GameMenu.open();
			}


			var gameRenderer;
			var editorRenderer;

			html5.getCanvas2dContext();
			jsEngine.start();

			jsEngine.userCallbacks['onGameStart'] = function () {
				gameRenderer = new scnBomberman.renderer();
				gameRenderer.scene = new scnBomberman.scene();

				jsEngine.modules.render.renderer = gameRenderer;

				createMenu();
				jsEngine.modules.ui.show(GameMenu);
			}

			jsEngine.userCallbacks['onGameUpdate'] = function () {
				// Atualiza combos
				jsEngine.modules.combo.update();

				// Renderiza a cena principal
				jsEngine.modules.render.render();

				// Renderiza o HUD
				jsEngine.modules.hud.render();

				// Renderiza mensagens
				jsEngine.modules.messages.render();

				// Renderiza partículas
				jsEngine.modules.particles.render();
			}
		</script>
		<audio src="assets/audio/explosion.wav" id="explosion" preload>
	</body>
</html>